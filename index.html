<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>pizero gps by kapusta</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>pizero gps</h1>
        <p>a side project using gps on a raspberry pi zero</p>
        <p class="view"><a href="https://github.com/kapusta/pizero-gps">View the Project on GitHub <small>kapusta/pizero-gps</small></a></p>
        <ul>
          <li><a href="https://github.com/kapusta/pizero-gps/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/kapusta/pizero-gps/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/kapusta/pizero-gps">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="gps-over-serial-on-your-raspberry-pi" class="anchor" href="#gps-over-serial-on-your-raspberry-pi" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>gps over serial on your raspberry pi</h1>

<h2>
<a id="assumptions" class="anchor" href="#assumptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Assumptions</h2>

<p>You...</p>

<ul>
<li>Have a #pizero with a GPIO header soldered onto it.</li>
<li>Have an <a href="https://www.adafruit.com/product/746">Adafruit Ultimate GPS Breakout</a>
</li>
<li>Have <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian Jessie</a> installed.</li>
<li>Have <a href="https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions">nodejs installed</a>.</li>
</ul>

<h2>
<a id="useful-guides" class="anchor" href="#useful-guides" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Useful Guides</h2>

<ul>
<li><a href="https://learn.adafruit.com/adafruit-ultimate-gps-on-the-raspberry-pi/using-uart-instead-of-usb">Connecting the Pi to the Adafruit Ultimate GPS Breakout</a></li>
<li>
<a href="https://www.youtube.com/watch?v=J6g53Hm0rq4">Compiling nodejs on your pi</a>.</li>
</ul>

<h2>
<a id="various-useful-commands" class="anchor" href="#various-useful-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Various Useful Commands</h2>

<ul>
<li>Kill gpsd - <code>sudo killall gpsd</code>
</li>
<li>Elegantly restart gpsd - <code>sudo /etc/init.d/gpsd restart</code>
</li>
<li>Terminal UI for gps data - <code>cgps -s</code>
</li>
<li>See raw data from the device - <code>cat /dev/ttyAMA0</code>
</li>
</ul>

<h2>
<a id="start-gpsd-in-verbosedebug-mode" class="anchor" href="#start-gpsd-in-verbosedebug-mode" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start gpsd in verbose/debug mode</h2>

<p>Log into your pi and install <code>gpsd</code></p>

<pre><code>sudo apt-get install gpsd gpsd-clients python-gps
</code></pre>

<p>...then try this command...</p>

<pre><code>sudo gpsd /dev/ttyAMA0 -D 2 -n -b -N -P /tmp/gpsd.pid -F /var/run/gpsd.sock
</code></pre>

<p>When starting <code>gpsd</code> you might see an error like this...</p>

<pre><code>gpsd:ERROR: can't bind to local socket /var/run/gpsd.sock
</code></pre>

<p>You can confirm data is coming to your #pizero with <code>cat /dev/ttyAMA0</code> which should show a stream of data. If you see data coming thru but the commands to start <code>gpsd</code> failed with an error about not being able to connect, then you might have to disable terminal over serial.</p>

<h2>
<a id="how-disable-terminal-over-serial" class="anchor" href="#how-disable-terminal-over-serial" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How disable terminal over serial</h2>

<p>These didn't work, not sure why...</p>

<pre><code>sudo systemctl stop serial-getty@ttyAMA0.service
sudo systemctl disable serial-getty@ttyAMA0.service
</code></pre>

<p>What did work was...</p>

<ul>
<li><code>sudo raspi-config</code></li>
<li>go to <code>Advanced Options</code>
</li>
<li>then <code>serial</code> and turn it off</li>
<li>reboot</li>
</ul>

<p>The Adafruit guide mentioned above says you can do this from <code>/etc/inittab</code> but that file doesn't exist in Raspbian Jessie (it did in Wheezy).</p>

<p>Raspbian Jessie has moved everything to services and there is no <code>/etc/inittab</code> file at all, so it's probabl;y best just to use the config command.</p>

<h2>
<a id="configure-gpsd" class="anchor" href="#configure-gpsd" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configure gpsd</h2>

<p>To have <code>gpsd</code> start up correctly, edit <code>/etc/default/gpsd</code></p>

<pre><code># Default settings for the gpsd init script and the hotplug wrapper.

# Start the gpsd daemon automatically at boot time
START_DAEMON="true"

# Use USB hotplugging to add new USB devices automatically to the daemon
USBAUTO="false"

# Devices gpsd should collect to at boot time.
# They need to be read/writeable, either by user gpsd or the group dialout.
DEVICES="/dev/ttyAMA0"

# Other options you want to pass to gpsd
GPSD_OPTIONS

GPSD_SOCKET="/var/run/gpsd.sock"
</code></pre>

<p>Then restart: <code>sudo /etc/init.d/gpsd restart</code></p>

<p>Then try <code>cgps -s</code> and you should now see real data appearing.</p>

<h2>
<a id="gps-data-via-nodejs" class="anchor" href="#gps-data-via-nodejs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GPS data via nodejs</h2>

<p>Now that data is coming from the gps unit, thru <code>gpsd</code>, we can read that data from node with the help of <a href="https://github.com/eelcocramer/node-gpsd">node-gpsd</a>.</p>

<p>This will handle the starting and stopping of <code>gpsd</code> for us and provide the data as JSON.</p>

<p>Have a look at the example.js file in this repo and try <code>node example.js</code> in your terminal. If everything is set up correctly, you should see a bunch of TPV events streaming by. Now you have something you can write an application around.</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/kapusta">kapusta</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-16063192-7");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
